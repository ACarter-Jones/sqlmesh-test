2024-04-09 16:38:55,902 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'db.db'} (connection.py:255)
2024-04-09 16:38:55,991 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:257)
2024-04-09 16:38:56,095 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: db.db (connection.py:250)
2024-04-09 16:39:00,232 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema db.sqlmesh__sqlmesh_example (evaluator.py:258)
2024-04-09 16:39:00,232 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:1822)
2024-04-09 16:39:00,233 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT CURRENT_CATALOG() (base.py:1822)
2024-04-09 16:39:00,235 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM information_schema.tables WHERE table_schema = 'sqlmesh__sqlmesh_example' AND table_name IN ('sqlmesh_example__full_model__1251628914', 'sqlmesh_example__seed_model__1248844913__temp', 'sqlmesh_example__incremental_model__3679155687', 'sqlmesh_example__incremental_model__3679155687__temp', 'sqlmesh_example__seed_model__1248844913', 'sqlmesh_example__full_model__1251628914__temp') (base.py:1822)
2024-04-09 16:39:00,258 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh__sqlmesh_example' (evaluator.py:809)
2024-04-09 16:39:00,258 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh__sqlmesh_example" (base.py:1822)
2024-04-09 16:39:00,263 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3679155687__temp' (evaluator.py:1083)
2024-04-09 16:39:00,264 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687__temp" ("id" INT, "item_id" INT, "new_column" TEXT, "event_date" DATE) (base.py:1822)
2024-04-09 16:39:00,264 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sqlmesh_example.incremental_model' (evaluator.py:1103)
2024-04-09 16:39:00,265 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", 'faked_out_col' AS "new_column", "seed_model"."event_date" AS "event_date" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1248844913" AS "seed_model" WHERE ("seed_model"."event_date" <= CAST('1970-01-01' AS DATE) AND "seed_model"."event_date" >= CAST('1970-01-01' AS DATE)) AND FALSE LIMIT 0 (base.py:1822)
2024-04-09 16:39:00,267 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3679155687' (evaluator.py:1083)
2024-04-09 16:39:00,267 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" ("id" INT, "item_id" INT, "new_column" TEXT, "event_date" DATE) (base.py:1822)
2024-04-09 16:39:00,272 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__1251628914__temp' (evaluator.py:1083)
2024-04-09 16:39:00,272 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914__temp" ("item_id" INT, "num_orders" BIGINT) (base.py:1822)
2024-04-09 16:39:00,272 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sqlmesh_example.full_model' (evaluator.py:1103)
2024-04-09 16:39:00,273 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" AS "incremental_model" WHERE FALSE GROUP BY "incremental_model"."item_id" LIMIT 0 (base.py:1822)
2024-04-09 16:39:00,274 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__1251628914' (evaluator.py:1083)
2024-04-09 16:39:00,274 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE TABLE IF NOT EXISTS "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914" ("item_id" INT, "num_orders" BIGINT) (base.py:1822)
2024-04-09 16:39:00,295 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"db"."sqlmesh_example"."incremental_model": 3909318139> (evaluator.py:464)
2024-04-09 16:39:00,299 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2020-01-01 00:00:00+00:00, 2024-04-09 00:00:00+00:00) into db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3679155687' (evaluator.py:488)
2024-04-09 16:39:00,300 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DELETE FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2024-04-08' AS DATE) (base.py:1822)
2024-04-09 16:39:00,302 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" ("id", "item_id", "new_column", "event_date") SELECT "id", "item_id", "new_column", "event_date" FROM (SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", 'faked_out_col' AS "new_column", "seed_model"."event_date" AS "event_date" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1248844913" AS "seed_model" WHERE "seed_model"."event_date" <= CAST('2024-04-08' AS DATE) AND "seed_model"."event_date" >= CAST('2020-01-01' AS DATE)) AS "_subquery" WHERE "event_date" BETWEEN CAST('2020-01-01' AS DATE) AND CAST('2024-04-08' AS DATE) (base.py:1822)
2024-04-09 16:39:00,303 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Adding interval (1577836800000, 1712620800000) for snapshot SnapshotId<"db"."sqlmesh_example"."incremental_model": 3909318139> (engine_adapter.py:631)
2024-04-09 16:39:00,309 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 1350976383> (evaluator.py:464)
2024-04-09 16:39:00,312 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2020-01-01 00:00:00+00:00, 2024-04-09 00:00:00+00:00) into db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__1251628914' (evaluator.py:488)
2024-04-09 16:39:00,313 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE TABLE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914" AS SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" AS "incremental_model" GROUP BY "incremental_model"."item_id" (base.py:1822)
2024-04-09 16:39:00,315 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 1350976383> (evaluator.py:386)
2024-04-09 16:39:00,315 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DESCRIBE "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914" (base.py:1822)
2024-04-09 16:39:00,349 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914" AS "sqlmesh_example__full_model__1251628914") AS "_q_0" WHERE "item_id" < 0) AS "audit" (base.py:1822)
2024-04-09 16:39:00,350 - MainThread - sqlmesh.core.state_sync.engine_adapter - INFO - Adding interval (1577836800000, 1712620800000) for snapshot SnapshotId<"db"."sqlmesh_example"."full_model": 1350976383> (engine_adapter.py:631)
2024-04-09 16:39:00,359 - MainThread - sqlmesh.core.state_sync.common - INFO - Promoting environment 'dev' (common.py:120)
2024-04-09 16:39:00,382 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'db.sqlmesh_example__dev' (evaluator.py:809)
2024-04-09 16:39:00,382 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE SCHEMA IF NOT EXISTS "db"."sqlmesh_example__dev" (base.py:1822)
2024-04-09 16:39:00,383 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example__dev.incremental_model' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3679155687' (evaluator.py:1041)
2024-04-09 16:39:00,383 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example__dev"."incremental_model" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3679155687" (base.py:1822)
2024-04-09 16:39:00,384 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'db.sqlmesh_example__dev.full_model' to point at table 'db.sqlmesh__sqlmesh_example.sqlmesh_example__full_model__1251628914' (evaluator.py:1041)
2024-04-09 16:39:00,384 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: CREATE OR REPLACE VIEW "db"."sqlmesh_example__dev"."full_model" AS SELECT * FROM "db"."sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__1251628914" (base.py:1822)
2024-04-09 16:39:00,385 - MainThread - sqlmesh.core.state_sync.common - INFO - Finalizing environment 'Environment<name: dev, snapshots: [SnapshotTableInfo<name: "db"."sqlmesh_example"."seed_model", change_category: 1, fingerprint: SnapshotFingerprint<2682453022, data: 1220485773, meta: 3675754436, pdata: 0, pmeta: 0>, version: 1248844913, physical_schema_: sqlmesh__sqlmesh_example, parents: (), kind_name: SEED>, SnapshotTableInfo<name: "db"."sqlmesh_example"."full_model", change_category: 4, fingerprint: SnapshotFingerprint<1350976383, data: 2650841478, meta: 2825355689, pdata: 1631598923, pmeta: 1768871832>, previous_versions: (SnapshotDataVersion<fingerprint: SnapshotFingerprint<2828824763, data: 2650841478, meta: 1700024854, pdata: 4025707506, pmeta: 276518137>, version: 3031530868, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1313860788, data: 2650841478, meta: 2825355689, pdata: 3170397133, pmeta: 1768871832>, version: 3031530868, temp_version: 3031530868, change_category: 5, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1344811104, data: 2650841478, meta: 2825355689, pdata: 1860268802, pmeta: 1768871832>, version: 3077117562, change_category: 4, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3053349484, data: 2650841478, meta: 2825355689, pdata: 3984525895, pmeta: 1768871832>, version: 275481706, change_category: 4, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<2089844728, data: 2650841478, meta: 2825355689, pdata: 3409591791, pmeta: 1768871832>, version: 2811575338, change_category: 4, physical_schema_: sqlmesh__sqlmesh_example>), version: 1251628914, physical_schema_: sqlmesh__sqlmesh_example, parents: (SnapshotId<"db"."sqlmesh_example"."incremental_model": 3909318139>,), kind_name: FULL>, SnapshotTableInfo<name: "db"."sqlmesh_example"."incremental_model", change_category: 1, fingerprint: SnapshotFingerprint<3909318139, data: 4113133341, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, previous_versions: (SnapshotDataVersion<fingerprint: SnapshotFingerprint<1146462437, data: 4029270082, meta: 418654361, pdata: 1870762845, pmeta: 3629104689>, version: 141311533, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3167203313, data: 4139297552, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 3269816977, change_category: 2, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1587709320, data: 1869426221, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 2730798287, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3591572115, data: 672404589, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 3935752408, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1144078704, data: 3163316302, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 799984573, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>), version: 3679155687, physical_schema_: sqlmesh__sqlmesh_example, parents: (SnapshotId<"db"."sqlmesh_example"."seed_model": 2682453022>,), kind_name: INCREMENTAL_BY_TIME_RANGE>], start_at: 2020-01-01 00:00:00+00:00, end_at: 1712620800000, plan_id: ab3df9b1409e47ae990adfd2ab30866d, previous_plan_id: 98c845026f87475fbdbfbf53b554b41c, expiration_ts: 1713225600000, promoted_snapshot_ids: [SnapshotId<"db"."sqlmesh_example"."full_model": 1350976383>, SnapshotId<"db"."sqlmesh_example"."incremental_model": 3909318139>], previous_finalized_snapshots: [SnapshotTableInfo<name: "db"."sqlmesh_example"."full_model", change_category: 4, fingerprint: SnapshotFingerprint<2089844728, data: 2650841478, meta: 2825355689, pdata: 3409591791, pmeta: 1768871832>, previous_versions: (SnapshotDataVersion<fingerprint: SnapshotFingerprint<2828824763, data: 2650841478, meta: 1700024854, pdata: 4025707506, pmeta: 276518137>, version: 3031530868, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1313860788, data: 2650841478, meta: 2825355689, pdata: 3170397133, pmeta: 1768871832>, version: 3031530868, temp_version: 3031530868, change_category: 5, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1344811104, data: 2650841478, meta: 2825355689, pdata: 1860268802, pmeta: 1768871832>, version: 3077117562, change_category: 4, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3053349484, data: 2650841478, meta: 2825355689, pdata: 3984525895, pmeta: 1768871832>, version: 275481706, change_category: 4, physical_schema_: sqlmesh__sqlmesh_example>), version: 2811575338, physical_schema_: sqlmesh__sqlmesh_example, parents: (SnapshotId<"db"."sqlmesh_example"."incremental_model": 1144078704>,), kind_name: FULL>, SnapshotTableInfo<name: "db"."sqlmesh_example"."incremental_model", change_category: 1, fingerprint: SnapshotFingerprint<1144078704, data: 3163316302, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, previous_versions: (SnapshotDataVersion<fingerprint: SnapshotFingerprint<1146462437, data: 4029270082, meta: 418654361, pdata: 1870762845, pmeta: 3629104689>, version: 141311533, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3167203313, data: 4139297552, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 3269816977, change_category: 2, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<1587709320, data: 1869426221, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 2730798287, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>, SnapshotDataVersion<fingerprint: SnapshotFingerprint<3591572115, data: 672404589, meta: 4016643932, pdata: 1870762845, pmeta: 3629104689>, version: 3935752408, change_category: 1, physical_schema_: sqlmesh__sqlmesh_example>), version: 799984573, physical_schema_: sqlmesh__sqlmesh_example, parents: (SnapshotId<"db"."sqlmesh_example"."seed_model": 2682453022>,), kind_name: INCREMENTAL_BY_TIME_RANGE>, SnapshotTableInfo<name: "db"."sqlmesh_example"."seed_model", change_category: 1, fingerprint: SnapshotFingerprint<2682453022, data: 1220485773, meta: 3675754436, pdata: 0, pmeta: 0>, version: 1248844913, physical_schema_: sqlmesh__sqlmesh_example, parents: (), kind_name: SEED>]>' (common.py:198)
